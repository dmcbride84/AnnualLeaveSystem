@{
    
    Layout = "~/_Layout.cshtml";
     Page.Title = "Tasks";   

    var theUserName = WebSecurity.CurrentUserName; 
    var firstName ="";
    var lastName="";
    var fullName="";
    var theLineManager ="";
    var testdate="";
    var requestStatus ="";

    ////////////////////////////////////////////// Fic

     /////<!-- Open a database connection-->
        var db = Database.Open("Annual Leave System");

        /////////////////////////

         var dbCommand1 = "SELECT * FROM UserProfile WHERE email = @0";
         var row = db.QuerySingle(dbCommand1, theUserName);

         firstName = row.firstName;
         lastName = row.lastName;
         fullName = firstName +" " + lastName;

         theLineManager = fullName;
         

           // if(row != null) {
              
              // var theLineManager = row.lineManager;
               
           // }

         
        /////////////////////////

         

         var dbCommand2 = "SELECT * FROM LeaveRequests WHERE lineManager = @0 ORDER BY requestStatus DESC";
         var selectedData = db.Query(dbCommand2, theLineManager);
         //var row2 = db.QuerySingle(dbCommand2, ID);
         //email = row2.email;
               
   
  
         var grid = new WebGrid(source: selectedData, rowsPerPage: 10);
}


        <h2>Leave Requests</h2>

        <div id='cssmenu'>
                    <ul>
                      <li class='active'><a href="@Href("~/Home")"><span>Home</span></a></li>
                      <li class='active'><a href="@Href("~/requestform")"><span>Leave Request</span></a></li>
                      <li class='active'><a href="@Href("~/admin_and_Managers/staffList")"><span>Staff List</span></a></li>
                      <li class='active'><a href="@Href("~/admin_and_Managers/calendar")"><span>View Calendar</span></a></li>
                      <li class='active'><a href="@Href("~/Managers/tasks")"><span>Current Tasks</span></a></li>
                      <li class='active'><a href="@Href("~/admin_and_Managers/ShowGraph")"><span>View Graph</span></a></li>
                      <li><a href="@Href("~/Logout")"><span>Logout</span></a></li>
                        
                     </ul>
                    </div>
                    <br>

        <div>
            @grid.GetHtml(
                tableStyle: "grid",
                headerStyle: "head",
                alternatingRowStyle: "alt",
                columns: grid.Columns(
                    grid.Column(format: @<a href="~/Managers/ProcessRequests?ID=@item.ID">Process</a>),
                    grid.Column("firstName"),
                    grid.Column("lastName"),
                    grid.Column("description"),
                    grid.Column("startDate"),
                    grid.Column("endDate"),
                    grid.Column("totalDays"),
                    grid.Column("requestStatus"),
                    grid.Column(format: @<a href="~/Managers/DeleteRequests?id=@item.ID">Delete</a>)
                   
                )
            )
        </div>

       
